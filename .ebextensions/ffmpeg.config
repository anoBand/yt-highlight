# .ebextensions/ffmpeg.config
packages:
  rpm:
    # Use the 'rpm' package manager to install the EPEL release RPM from the URL.
    # This can sometimes be more resilient for installing repository RPMs.
    epel: https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm

commands:
  01_wait_for_epel_repo:
    # After 'packages:rpm' installs epel-release, yum might need a moment
    # or a 'yum clean all' before it fully recognizes the new EPEL repository.
    # This command attempts to clean the cache to help yum see the new repo.
    # The 'test' ensures it only runs if EPEL seems to be configured (via rpm)
    # but ffmpeg is not yet available (implying yum hasn't used EPEL yet).
    command: "sudo yum clean all"
    test: "yum repolist | grep -q epel && ! ffmpeg -version"
    # Adding ignore_errors as this is a preparatory step.
    ignore_errors: true 

  02_install_ffmpeg:
    # Attempt to install ffmpeg. If EPEL was successfully enabled by 'packages:rpm:',
    # yum should now be able to find ffmpeg in the EPEL repository.
    command: "sudo yum install -y ffmpeg"
    test: "! ffmpeg -version" # Run if ffmpeg is not installed