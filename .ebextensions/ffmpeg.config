# .ebextensions/01_ffmpeg.config

commands:
  01_install_epel:
    command: "sudo amazon-linux-extras install -y epel"
    # test: "rpm -q epel-release" # 이 test 명령은 amazon-linux-extras와 호환되지 않을 수 있으므로 제거하거나 아래와 같이 변경합니다.
    test: "yum repolist | grep -q 'epel/'" # epel 저장소가 활성화되었는지 확인
    ignoreErrors: false # 이 단계는 매우 중요하므로 에러 발생 시 중단되도록 합니다.

  02_install_rpmfusion_free:
    command: "sudo yum install -y https://download1.rpmfusion.org/free/el/rpmfusion-free-release-7.noarch.rpm"
    test: "rpm -q rpmfusion-free-release" # rpmfusion-free가 설치되었는지 확인
    ignoreErrors: false

  03_install_rpmfusion_nonfree:
    command: "sudo yum install -y https://download1.rpmfusion.org/nonfree/el/rpmfusion-nonfree-release-7.noarch.rpm"
    test: "rpm -q rpmfusion-nonfree-release" # rpmfusion-nonfree가 설치되었는지 확인
    ignoreErrors: false
  
  04_yum_clean_all:
    command: "sudo yum clean all"
    
  05_install_ffmpeg:
    # packages 섹션 대신 command로 직접 설치합니다.
    command: "sudo yum install -y ffmpeg ffmpeg-devel"
    # 이미 설치되어 있는지 확인하는 test 명령을 추가하여 불필요한 재설치를 방지합니다.
    test: "rpm -q ffmpeg"