# .ebextensions/ffmpeg.config
commands:
  01_install_dnf_utils:
    # On the minimal AL2023 Beanstalk image, dnf-utils (which provides 'config-manager') is not pre-installed.
    # We must install it first to manage repositories.
    command: "sudo dnf install -y dnf-utils"
    test: "! ffmpeg -version"

  02_enable_epel:
    # Now that we have dnf-utils, we can use config-manager to enable the EPEL repository.
    # EPEL is a prerequisite for RPM Fusion.
    command: "sudo dnf config-manager --set-enabled epel"
    test: "! ffmpeg -version"

  03_install_rpmfusion_free:
    # With EPEL enabled, we can now successfully install the RPM Fusion 'free' repository.
    command: "sudo dnf install -y https://mirrors.rpmfusion.org/free/el/rpmfusion-free-release-9.noarch.rpm"
    test: "! ffmpeg -version"

  04_install_rpmfusion_nonfree:
    # Install the RPM Fusion 'nonfree' repository.
    command: "sudo dnf install -y https://mirrors.rpmfusion.org/nonfree/el/rpmfusion-nonfree-release-9.noarch.rpm"
    test: "! ffmpeg -version"

  05_install_ffmpeg:
    # With all repositories correctly set up in the right order, finally install ffmpeg.
    command: "sudo dnf install -y --allowerasing ffmpeg ffmpeg-devel"
    test: "! ffmpeg -version"