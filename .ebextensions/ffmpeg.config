# .ebextensions/ffmpeg.config
commands:
  01_enable_epel:
    # On Amazon Linux 2023, the EPEL repository is included but disabled by default.
    # We must enable it first, as it's a prerequisite for RPM Fusion.
    command: "sudo dnf config-manager --set-enabled epel"
    test: "! ffmpeg -version"

  02_install_rpmfusion_free:
    # Now that EPEL is enabled, we can install the RPM Fusion 'free' repository.
    command: "sudo dnf install -y https://mirrors.rpmfusion.org/free/el/rpmfusion-free-release-9.noarch.rpm"
    test: "! ffmpeg -version"

  03_install_rpmfusion_nonfree:
    # Install the RPM Fusion 'nonfree' repository.
    command: "sudo dnf install -y https://mirrors.rpmfusion.org/nonfree/el/rpmfusion-nonfree-release-9.noarch.rpm"
    test: "! ffmpeg -version"

  04_install_ffmpeg:
    # With all repositories correctly set up, install ffmpeg.
    # --allowerasing is a robust flag that helps resolve potential package conflicts.
    command: "sudo dnf install -y --allowerasing ffmpeg ffmpeg-devel"
    test: "! ffmpeg -version"