# .ebextensions/ffmpeg.config
# This script installs ffmpeg by manually providing the URLs for all required
# repository configuration packages, making no assumptions about the base AMI.

commands:
  01_install_epel_repo_from_url:
    # We install the EPEL repository configuration directly from its source URL.
    # This bypasses any issues with the base AMI's default repo list.
    command: "sudo dnf install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-9.noarch.rpm"
    # Run only if ffmpeg is not yet installed.
    test: "! ffmpeg -version"

  02_install_rpmfusion_repos_from_url:
    # With EPEL installed, we now install the RPM Fusion repositories from their source URLs.
    command: "sudo dnf install -y https://mirrors.rpmfusion.org/free/el/rpmfusion-free-release-9.noarch.rpm https://mirrors.rpmfusion.org/nonfree/el/rpmfusion-nonfree-release-9.noarch.rpm"
    # Run only if ffmpeg is not yet installed.
    test: "! ffmpeg -version"

  03_install_ffmpeg_package:
    # Now that all repositories are configured correctly, install ffmpeg itself.
    command: "sudo dnf install -y ffmpeg ffmpeg-devel"
    # Run only if ffmpeg is not yet installed.
    test: "! ffmpeg -version"