# .ebextensions/ffmpeg.config
commands:
  01_install_epel_release:
    # Try to install epel-release package directly using yum
    # This is often what 'amazon-linux-extras install epel' does
    command: "sudo yum install -y https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm"
    # Test if epel repository is now configured
    test: "! yum repolist | grep -q epel"

  02_install_ffmpeg:
    # Install ffmpeg, hopefully from EPEL
    command: "sudo yum install -y ffmpeg"
    test: "! ffmpeg -version"

  03_clean_yum_cache:
    # Clean yum cache as we've modified repositories
    command: "sudo yum clean all"
    # Run this if the previous commands ran, or always if ffmpeg isn't installed
    test: "! ffmpeg -version"