# .ebextensions/ffmpeg.config
# This script installs a static, self-contained build of ffmpeg.
# This method avoids all system package manager and repository dependency issues.

commands:
  01_download_ffmpeg:
    # Download a trusted, recent, static build of ffmpeg.
    # The 'test' command checks if the final file already exists to make this idempotent.
    command: "curl -o /tmp/ffmpeg.tar.xz https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz"
    test: "! test -f /usr/bin/ffmpeg"

  02_extract_ffmpeg:
    # Extract the downloaded archive into the /tmp directory.
    command: "tar -xf /tmp/ffmpeg.tar.xz -C /tmp"
    test: "! test -f /usr/bin/ffmpeg"

  03_install_ffmpeg_and_ffprobe:
    # Move the ffmpeg and ffprobe executables to a directory in the system's PATH.
    # The wildcard '*' makes this command robust against future version changes in the download.
    # This single command moves both files.
    command: "sudo mv /tmp/ffmpeg-*-amd64-static/ffmpeg /tmp/ffmpeg-*-amd64-static/ffprobe /usr/bin/"
    test: "! test -f /usr/bin/ffmpeg"